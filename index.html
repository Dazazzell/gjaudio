<!DOCTYPE html>
<html>
<head>
  <title>MP3 Voting</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
</head>
<body>
  <h1>MP3 Voting</h1>
  <div id="track-list"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDp_cESC1PrXHxnTC2JMRdR928KXXwEvOw",
      authDomain: "gjaudio-d18d9.firebaseapp.com",
      projectId: "gjaudio-d18d9.firebaseapp.com",
      storageBucket: "gjaudio-d18d9.firebasestorage.app",
      messagingSenderId: "740115381859",
      appId: "1:740115381859:web:a19505a463269198274256"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // Sign in anonymously
    signInAnonymously(auth).then(() => {
      console.log('Signed in anonymously');
    });

    const tracks = [
      { id: 'track1', title: 'Track One', mp3: 'track1.mp3' },
      { id: 'track2', title: 'Track Two', mp3: 'track2.mp3' }
    ];

    const container = document.getElementById('track-list');

    tracks.forEach(track => {
      const div = document.createElement('div');
      div.innerHTML = `
        <h3>${track.title}</h3>
        <audio controls src="${track.mp3}"></audio>
        <div>
          ${[...Array(10)].map((_, i) =>
            `<button data-score="${i+1}" data-id="${track.id}">${i+1}</button>`
          ).join('')}
        </div>
      `;
      container.appendChild(div);

      div.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', async () => {
          const score = btn.dataset.score;
          const id = btn.dataset.id;

          const user = auth.currentUser;
          const voteRef = doc(db, "votes", `${user.uid}_${id}`);
          await setDoc(voteRef, { score: Number(score), trackId: id, user: user.uid });

          alert(`Voted ${score} on ${id}`);
        });
      });
    });
  </script>
</body>
</html>
